!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0});var s,r=i(2),n=(s=r)&&s.__esModule?s:{default:s};var o="undefined"!=typeof window&&window||t,a=o.voPlayer;a||(a=o.voPlayer={}),a.voCaptionParserPlugin=n.default,e.default=a}).call(this,i(1))},function(t,e){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(t){"object"==typeof window&&(i=window)}t.exports=i},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=function(){function t(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(e,i,s){return i&&t(e.prototype,i),s&&t(e,s),e}}(),r=o(i(3)),n=o(i(4));function o(t){return t&&t.__esModule?t:{default:t}}var a=function(t,e,i){for(var s=function(t,e,i,s){if(s+e>i.byteLength)return null;if(4!==t||e<8)return null;var r=i.getUint8(s),n=i.getUint16(s+1),o=i.getUint32(s+3),a=i.getUint8(s+7);return 181===r&&49===n&&1195456820===o&&3===a},r=[],n=e,o=-1;n<i-1;){o=0;for(var a=255;255===a&&n<i-1;)o+=a=t.getUint8(n),n++;var h=0;for(a=255;255===a&&n<i-1;)h+=a=t.getUint8(n),n++;s(o,h,t,n)&&r.push({raw:t,ranges:[n+8,h-8]}),n+=h}return r},h=[],u=new n.default.Cea708PacketParser,c=function(t,e){var i=e[0],s=[[],[],[],[],[],[],[],[]],r=function(t,e,i,s){return 0!==t&&((0===s||1===s)&&!(128==e&&128==i||0===e&&0===i||(127&e)+(127&i)==0))},n=function(t,e,i,s){return 0!==t&&((2===s||3===s)&&(0!==e||0!==i))},o=function(t,e,i){return t>0&&(3===e&&1===i||0===i)},a=function(){if(u.extractCea708DataFromPacket(h))for(var t=1;t<u.serviceBlock.serData.length;t++)u.serviceBlock.serData[t].serData.length&&(s[t+1]=s[t+1].concat(u.serviceBlock.serData[t].serData))},c=31&t.getUint8(i);i+=2;for(var l=0;l<c;l++){var f=t.getUint8(i),d=(4&f)>>2,p=3&f;i++;var C=t.getUint8(i);i++;var w=t.getUint8(i);if(i++,1!==d||0!==p&&1!==p){if(2===p||3===p)if(o(h.length,p,d))a(),h=[],l--,i-=3;else if(1===d){if(0===h.length&&!n(d,C,w,p))continue;h.push(C),h.push(w)}}else{if(!r(d,C,w,p))continue;if(0===C)continue;0===p?(s[0].push(C),s[0].push(w)):1===p&&(s[1].push(C),s[1].push(w))}}return function(t){for(var e=[],i=0;i<t.length;i++)0<t[i].length&&(0===i?e.push(["608_1",t[i]]):1==i?e.push(["608_3",t[i]]):e.push(["708_"+(i-1).toString(),t[i]]));return e}(s)},l=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.out_=e,this.ceaParsers_=[]}return s(t,null,[{key:"voName",get:function(){return"voCaptionParserPlugin"}}]),s(t,[{key:"reset",value:function(){this.ceaParsers_.forEach((function(t){t.reset()}))}},{key:"setInputData",value:function(t){var e=function(t){for(var e=function(t,e){var i=t.subarray(0,e),s=t.subarray(e+1),r=new Uint8Array(t.length-1);return r.set(i),r.set(s,e),r},i=function(t,i,s){do{t[i]?i+=1:t[i+1]?i+=2:3!==t[i+2]?i+=3:(t=e(t,i+2),i+=2,s-=1)}while(i+3<s);return{data:t,size:s}},s=function(t,e){var i=new Uint8Array(4);return i.set(e.subarray(t,t+4)),new DataView(i.buffer).getUint32(0)},r=0,n=0,o=[];r<t.length;){if(n=s(r,t),6===(31&t[r+4])){var h=i(t,r+5,n-1);t=h.data,n=h.size+1;var u=new Uint8Array(n-1);u.set(t.subarray(r+5,r+5+n-1));var c=new DataView(u.buffer);o=o.concat(a(c,0,c.byteLength))}r+=4+n}return o}(t.data);if(!(0>=e.length))for(var i=0;i<e.length;i++)for(var s=c(e[i].raw,e[i].ranges),r=0;r<s.length;r++){var n=this.createCeaParser(s[r][0],this.out_);n&&n.addData(parseFloat(t.t.toFixed(3)),s[r][1])}}},{key:"createCeaParser",value:function(t,e){for(var i=!1,s=0;s<this.ceaParsers_.length;s++)if(t===this.ceaParsers_[s].type)return i=!0,this.ceaParsers_[s];if(!i){var o=function(t,e){var i=null;return"608_1"===t?(i=new r.default.Cea608Parser(0,t,e,e),r.default.logger.setLogLevel(0)):"608_3"==t?i=new r.default.Cea608Parser(1,t,e,e):(i=new n.default.Cea708parser(t,e),n.default.logger.setLogLevel(0)),i}(t,e);return o&&this.ceaParsers_.push(o),o}}},{key:"setRectPos",value:function(t,e,i,s){var r=new n.default.RectPos;return n.default.setRectPos(r,t,e,i,s)}}]),t}();e.default=l},function(t,e,i){"use strict";!function(t){var e={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},i=function(t){var i=t;return e.hasOwnProperty(t)&&(i=e[t]),String.fromCharCode(i)},s={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},r={17:2,18:4,21:6,22:8,23:10,19:13,20:15},n={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},o={25:2,26:4,29:6,30:8,31:10,27:13,28:15},a=["white","green","blue","cyan","red","yellow","magenta","black","transparent"],h={verboseFilter:{DATA:4,DEBUG:4,INFO:4,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,logObj:null,setTime:function(t){this.time=t},log:function(t,e){var i=this.verboseFilter[t];this.verboseLevel>=i&&console.log(this.time+" ["+t+"] "+e)},setLogLevel:function(t){this.verboseLevel=t},setLog:function(t){this.logObj=t},log2:function(t){this.logObj?this.logObj.log(t):console.log("set log obj fail!")}},u=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e},c=function(t,e,i,s,r){this.foreground=t||"white",this.underline=e||!1,this.italics=i||!1,this.background=s||"black",this.flash=r||!1};c.prototype={reset:function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},setStyles:function(t){for(var e=["foreground","underline","italics","background","flash"],i=0;i<e.length;i++){var s=e[i];t.hasOwnProperty(s)&&(this[s]=t[s])}},isDefault:function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},equals:function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},copy:function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},toString:function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}};var l=function(t,e,i,s,r,n){this.uchar=t||" ",this.penState=new c(e,i,s,r,n)};l.prototype={reset:function(){this.uchar=" ",this.penState.reset()},setChar:function(t,e){this.uchar=t,this.penState.copy(e)},setPenState:function(t){this.penState.copy(t)},equals:function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},copy:function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},isEmpty:function(){return" "===this.uchar&&this.penState.isDefault()}};var f=function(){this.chars=[];for(var t=0;t<32;t++)this.chars.push(new l);this.pos=0,this.currPenState=new c};f.prototype={equals:function(t){for(var e=!0,i=0;i<32;i++)if(!this.chars[i].equals(t.chars[i])){e=!1;break}return e},copy:function(t){for(var e=0;e<32;e++)this.chars[e].copy(t.chars[e])},isEmpty:function(){for(var t=!0,e=0;e<32;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},setCursor:function(t){this.pos!==t&&(this.pos=t),this.pos<0?(h.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>32&&(h.log("ERROR","Too large cursor position "+this.pos),this.pos=32)},moveCursor:function(t){var e=this.pos+t;if(e>=32)h.log("DEBUG","cann not move cursor to "+e);else{if(t>1)for(var i=this.pos+1;i<e+1;i++)this.chars[i].setPenState&&this.chars[i].setPenState(this.currPenState);this.setCursor(e)}},backSpace:function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},insertChar:function(t){t>=144&&this.backSpace();var e=i(t);this.pos>=32?h.log("DEBUG","Cannot insert "+t.toString(16)+" (char) at position this.pos. Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},clearFromPos:function(t){var e;for(e=t;e<32;e++)this.chars[e].reset()},clear:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},clearToEndOfRow:function(){this.clearFromPos(this.pos)},getTextString:function(){for(var t=[],e=!0,i=0;i<32;i++){var s=this.chars[i].uchar;" "!==s&&(e=!1),t.push(s)}return e?"":t.join("")},setPenStyles:function(t){if(!(32<=this.pos)){this.currPenState.setStyles(t);var e=this.chars[this.pos];e.setPenState&&e.setPenState(this.currPenState)}}};var d=function(){this.rows=[];for(var t=0;t<15;t++)this.rows.push(new f);this.currRow=14,this.nrRollUpRows=null,this.reset()};d.prototype={reset:function(){for(var t=0;t<15;t++)this.rows[t].clear();this.currRow=14},equals:function(t){for(var e=!0,i=0;i<15;i++)if(!this.rows[i].equals(t.rows[i])){e=!1;break}return e},copy:function(t){for(var e=0;e<15;e++)this.rows[e].copy(t.rows[e])},isEmpty:function(){for(var t=!0,e=0;e<15;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},backSpace:function(){this.rows[this.currRow].backSpace()},clearToEndOfRow:function(){this.rows[this.currRow].clearToEndOfRow()},insertChar:function(t){this.rows[this.currRow].insertChar(t)},setPen:function(t){this.rows[this.currRow].setPenStyles(t)},moveCursor:function(t){this.rows[this.currRow].moveCursor(t)},setCursor:function(t){h.log("INFO","setCursor: "+t),this.rows[this.currRow].setCursor(t)},setPAC:function(t){h.log("INFO","pacData = "+JSON.stringify(t));var e=t.row-1;this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.currRow=e;var i=this.rows[this.currRow];if(null!==t.indent){var s=t.indent,r=Math.max(s-1,0);i.setCursor(t.indent),t.color=i.chars[r].penState.foreground}var n={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(n)},setBkgData:function(t){h.log("INFO","bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},setRollUpRows:function(t){this.nrRollUpRows=t},rollUp:function(){if(null!==this.nrRollUpRows){h.log("TEXT",this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),h.log("INFO","Rolling up")}else h.log("DEBUG","roll_up but nrRollUpRows not set yet")},getDisplayText:function(t){t=t||!1;for(var e=[],i="",s=-1,r=0;r<15;r++){var n=this.rows[r].getTextString();n&&(s=r+1,t?e.push("Row "+s+': "'+n+'"'):e.push(n.trim()))}return e.length>0&&(i=t?"["+e.join(" | ")+"]":e.join("\n")),i},getTextAndFormat:function(){return this.rows}};var p=function(t,e){this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new d,this.nonDisplayedMemory=new d,this.lastOutputScreen=new d,this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.type=" "};p.prototype={modes:["MODE_ROLL-UP","MODE_POP-ON","MODE_PAINT-ON","MODE_TEXT"],reset:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null,this.type=" "},getHandler:function(){return this.outputFilter},setHandler:function(t){this.outputFilter=t},setPAC:function(t){this.writeScreen.setPAC(t)},setBkgData:function(t){this.writeScreen.setBkgData(t)},setMode:function(t){t!==this.mode&&(this.mode=t,h.log("INFO","MODE="+t),"MODE_POP-ON"==this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},insertChars:function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var i=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";h.log("INFO",i+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(h.log("TEXT","DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},cc_RCL:function(){h.log("INFO","RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},cc_BS:function(){h.log("INFO","BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},cc_AOF:function(){},cc_AON:function(){},cc_DER:function(){h.log("INFO","DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},cc_RU:function(t){h.log("INFO","RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},cc_FON:function(){h.log("INFO","FON - Flash On"),this.writeScreen.setPen({flash:!0})},cc_RDC:function(){h.log("INFO","RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},cc_TR:function(){h.log("INFO","TR"),this.setMode("MODE_TEXT")},cc_RTD:function(){h.log("INFO","RTD"),this.setMode("MODE_TEXT")},cc_EDM:function(){h.log("INFO","EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate()},cc_CR:function(){h.log("CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate()},cc_ENM:function(){h.log("INFO","ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},cc_EOC:function(){if(h.log("INFO","EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,h.log("TEXT","DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate()},cc_TO:function(t){h.log("INFO","TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},cc_MIDROW:function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var i=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][i]}h.log("INFO","MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},outputDataUpdate:function(){var t=h.time;null!==t&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(t,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?!this.displayedMemory.equals(this.lastOutputScreen)&&this.cueStartTime<t&&(this.outputFilter.newCue&&(this.lastOutputScreen.type=this.type,this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen)),this.cueStartTime=this.displayedMemory.isEmpty()?null:t):this.cueStartTime=t,this.lastOutputScreen.copy(this.displayedMemory))},cueSplitAtTime:function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))}};var C=["XDS_Mode","Caption_Mode"],w=function(t,e,i,s){this.type=e,this.field=t||0,this.outputs=[i,s],this.channels=[new p(1,i),new p(2,s)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={padding:0,char:0,cmd:0,other:0},this.captionModes=C[1]};w.prototype={getHandler:function(t){return this.channels[t].getHandler()},setHandler:function(t,e){this.channels[t].setHandler(e)},addData:function(t,e){var i,s,r,n=!1;this.lastTime=t,h.setTime(t);for(var o=0;o<e.length;o+=2)if(s=127&e[o],r=127&e[o+1],0!==s||0!==r){if(h.log("DATA","["+u([e[o],e[o+1]])+"] -> ("+u([s,r])+")"),(i=this.parseCmd(s,r))||(i=this.parseMidrow(s,r)),i||(i=this.parsePAC(s,r)),i||(i=this.parseBackgroundAttributes(s,r)),!i){if(C[1]!==this.captionModes)continue;if(n=this.parseChars(s,r))if(this.currChNr&&this.currChNr>=0)this.channels[this.currChNr-1].insertChars(n);else h.log("WARNING","No channel found yet. TEXT-MODE?")}i?(this.captionModes=C[1],this.dataCounters.cmd+=2):n?this.dataCounters.char+=2:(this.captionModes=C[0],this.dataCounters.other+=2,h.log("WARNING","Couldn't parse cleaned data "+u([s,r])+" orig: "+u([e[o],e[o+1]])))}else this.dataCounters.padding+=2},parseCmd:function(t,e){var i=null,s=0;if(0===this.field?s=(20===t||28===t)&&32<=e&&e<=47:1===this.field&&(s=(21===t||29===t)&&32<=e&&e<=47),!s&&!((23===t||31===t)&&33<=e&&e<=35))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,h.log("DEBUG","Repeated command ("+u([t,e])+") is dropped"),!0;0===this.field?20===t||23===t?(i=1,this.channels[i-1].type="608_1"):(i=2,this.channels[i-1].type="608_2"):1===this.field&&(21===t||23===t?(i=1,this.channels[i-1].type="608_3"):(i=2,this.channels[i-1].type="608_4"));var r=this.channels[i-1];return 0===this.field&&(20===t||28===t)||1===this.field&&(21===t||29===t)?32===e?r.cc_RCL():33===e?r.cc_BS():34===e?r.cc_AOF():35===e?r.cc_AON():36===e?r.cc_DER():37===e?r.cc_RU(2):38===e?r.cc_RU(3):39===e?r.cc_RU(4):40===e?r.cc_FON():41===e?r.cc_RDC():42===e?r.cc_TR():43===e?r.cc_RTD():44===e?r.cc_EDM():45===e?r.cc_CR():46===e?r.cc_ENM():47===e&&r.cc_EOC():r.cc_TO(e-32),this.lastCmdA=t,this.lastCmdB=e,this.currChNr=i,!0},parseMidrow:function(t,e){var i=null;return(17===t||25===t)&&32<=e&&e<=47&&((i=17===t?1:2)!==this.currChNr?(h.log("ERROR","Mismatch channel in midrow parsing"),!1):(this.channels[i-1].cc_MIDROW(e),h.log("DEBUG","MIDROW ("+u([t,e])+")"),!0))},parsePAC:function(t,e){var i,a=null;if(!((17<=t&&t<=23||25<=t&&t<=31)&&64<=e&&e<=127)&&!((16===t||24===t)&&64<=e&&e<=95))return!1;if(t===this.lastCmdA&&e===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;if(i=t<=23?1:2,a=64<=e&&e<=95?1===i?s[t]:n[t]:1===i?r[t]:o[t],i!=this.currChNr)return h.log("ERROR","Mismatch channel in PAC parsing"),!1;var u=this.interpretPAC(a,e);return this.channels[i-1].setPAC(u),this.lastCmdA=t,this.lastCmdB=e,!0},interpretPAC:function(t,e){var i=e,s={color:null,italics:!1,indent:null,underline:!1,row:t};return i=e>95?e-96:e-64,s.underline=1==(1&i),i<=13?s.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(i/2)]:i<=15?(s.italics=!0,s.color="white"):s.indent=4*Math.floor((i-16)/2),s},parseChars:function(t,e){var s=null,r=null,n=null;if(t>=25?(s=2,n=t-8):(s=1,n=t),17<=n&&n<=19){var o=e;o=17===n?e+80:18===n?e+112:e+144,h.log("INFO","Special char '"+i(o)+" in channel "+s+", field:"+this.field),r=[o]}else 32<=t&&t<=127&&(r=0===e?[t]:[t,e]);if(r){var a=u(r);h.log("DEBUG","Char codes =  "+a.join(",")),this.lastCmdA=null,this.lastCmdB=null}return r},parseBackgroundAttributes:function(t,e){var i,s,r;return((16===t||24===t)&&32<=e&&e<=47||(23===t||31===t)&&45<=e&&e<=47)&&(i={},16===t||24===t?(s=Math.floor((e-32)/2),i.background=a[s],e%2==1&&(i.background=i.background+"_semi")):45===e?i.background="transparent":(i.foreground="black",47===e&&(i.underline=!0)),r=t<24?1:2,this.channels[r-1].setBkgData(i),this.lastCmdA=null,this.lastCmdB=null,!0)},reset:function(){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].reset();this.lastCmdA=null,this.lastCmdB=null},cueSplitAtTime:function(t){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].cueSplitAtTime(t)}};t.logger=h,t.PenState=c,t.CaptionScreen=d,t.Cea608Parser=w,t.findCea608Nalus=function(t,e,i){for(var s=0,r=e,n=[],o=function(t,e,i,s){if(4!==t||e<8)return null;var r=i.getUint8(s),n=i.getUint16(s+1),o=i.getUint32(s+3),a=i.getUint8(s+7);return 181==r&&49==n&&1195456820==o&&3==a};r<e+i;){if(s=t.getUint32(r),6===(31&t.getUint8(r+4)))for(var a=r+5,h=-1;a<r+4+s-1;){h=0;for(var u=255;255===u;)h+=u=t.getUint8(a),a++;var c=0;for(u=255;255===u;)c+=u=t.getUint8(a),a++;o(h,c,t,a)&&n.push([a,c]),a+=c}r+=s+4}return n},t.extractCea608DataFromRange=function(t,e){var i=e[0],s=[[],[]];i+=8;var r=31&t.getUint8(i);i+=2;for(var n=0;n<r;n++){var o=t.getUint8(i),a=4&o,h=3&o;i++;var u=t.getUint8(i);i++;var c=t.getUint8(i);i++,a&&(127&u)+(127&c)!=0&&(0===h?(s[0].push(u),s[0].push(c)):1===h&&(s[1].push(u),s[1].push(c)))}return s}}(e)},function(t,e,i){"use strict";!function(t){if("undefined"==typeof print_scrollDirection)var e={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1,TOP_TO_BOTTOM:2,BOTTOM_TO_TOP:3};var i=[[32,32],[33,32],[37,8230],[42,352],[44,338],[48,9608],[49,8216],[50,8217],[51,8220],[52,8221],[53,8226],[57,8482],[58,353],[60,339],[61,8480],[63,376],[118,8539],[119,8540],[120,8541],[121,8542],[122,8212],[123,8969],[124,8970],[125,8212],[126,8971],[127,8968],[160,8221]],s=[[0,0,12,0],[192,0,12,0],[0,0,14,0],[0,0,76,0],[192,0,76,0],[0,0,78,0],[0,0,36,0]],r=[[5,0],[5,1],[5,2],[5,3],[5,4],[5,27],[5,28]],n=[[42,0,0],[42,0,0],[42,0,0],[42,0,0],[42,0,0],[42,48,0],[42,48,0]],o=function(t){return t>>7},a=function(t){return t>>6&1},h=function(t){return t>>5&1},u=function(t){return t>>6},c=function(t){return t>>4&3},l=function(t){return t>>2&3},f=function(t){return 3&t},d=function(t){return t>>3&7},p=function(t){return 7&t},C=function(t){return t>>4},w=function(t){return 15&t},g=function(t){return 31&t},R=function(t){return 63&t},v={verboseFilter:{DATA:3,DEBUG:4,INFO:2,WARNING:2,TEXT:1,ERROR:0},time:null,verboseLevel:0,logObj:null,setTime:function(t){this.time=t},log:function(t,e){var i=this.verboseFilter[t];this.verboseLevel>=i&&console.log(this.time+" ["+t+"] "+e)},setLogLevel:function(t){this.verboseLevel=t},setLog:function(t){this.logObj=t},log2:function(t){this.logObj?this.logObj.log(t):console.log("set log obj fail!")}},D=function(t,e){return t.hasOwnProperty(e)},y=function(t,e,i){for(var s=0;s<t.length;s++){var r=t[s];D(e,r)&&(i[r]=e[r])}return i},T=function(t,e){if(e=void 0===e||e,t>15)return v.log("ClosedCaption Error:Error nRowNo"),0;var i=5*t;return e?i+10:i},I=function(t,e){var i=0;return(e=void 0===e||e)&&(t-=10),0===t?i:i=t/5},m=function(t,e){if(e=void 0===e||e,t>33)return v.log("ClosedCaption Error:Error nColumnNo"),0;var i=parseInt(25*t/10);return e?i+10:i},S=function(t,e,i,s,r,n){return n=void 0===n||n,e<15&&(t.Top=T(e,n)),i<15&&(t.Bottom=T(i+1,n)),s<32&&(t.Left=m(s,n)),r<32&&(t.Right=m(r+1,n)),t},E=function(t,e,i,s){this.Red=t||255,this.Green=e||255,this.Blue=i||255,this.Trans=s||255};E.prototype={reset:function(){this.Red=255,this.Green=255,this.Blue=255,this.Trans=255},isDefault:function(){return 255===this.Red&&255===this.Green&&255===this.Blue&&255===this.Trans},setColor:function(t){if(!t)return!1;return y(["Red","Green","Blue","Trans"],t,this),!0},equals:function(t){return this.Red===t.Red&&this.Green===t.Green&&this.Blue===t.Blue&&this.Trans===t.Trans}};var b=function(t,e,i){this.EffectType=t,this.EffectDirection=e,this.EffectSpeed=i};b.prototype={reset:function(){this.EffectType=0,this.EffectDirection=0,this.EffectSpeed=0},setRectDisplayEffect:function(t){if(t){y(["EffectType","EffectDirection","EffectSpeed"],t,this)}},isDefault:function(){return 0===this.EffectType&&0===this.EffectDirection&&0===this.EffectSpeed}};var O=function(t,e,i,s){this.Top=t||4294967295,this.Left=e||4294967295,this.Bottom=i||4294967295,this.Right=s||4294967295};O.prototype={reset:function(){this.Top=4294967295,this.Left=4294967295,this.Bottom=4294967295,this.Right=4294967295},copy:function(t){this.Top=t.Top,this.Left=t.Left,this.Bottom=t.Bottom,this.Right=t.Right},setRect:function(t){if(t){y(["Top","Left","Bottom","Right"],t,this),v.log("DEBUG","[setRect], T:"+this.Top+"，L："+this.Left+", B:"+this.Bottom+", R:"+this.Right)}},isDefault:function(){return 4294967295===this.Top&&4294967295===this.Left&&4294967295===this.Bottom&&4294967295===this.Right}};var F=function(t,e){this.RectBorderType=t,this.RectZOrder=e,this.Rect=new O,this.RectBorderColor=new E,this.RectFillColor=new E,this.RectDisplayEffect=new b};F.prototype={reset:function(){this.RectBorderType=0,this.RectZOrder=0,this.Rect.reset(),this.RectBorderColor.reset(),this.RectFillColor.reset(),this.RectDisplayEffect.reset()},setRectInfo:function(t){t&&(D(t,"RectBorderType")&&(this.RectBorderType=t.RectBorderType),D(t,"RectZOrder")&&(this.RectZOrder=t.RectZOrder),D(t,"Rect")&&this.Rect.setRect(t.Rect),D(t,"RectBorderColor")&&this.RectBorderColor.setColor(t.RectBorderColor),D(t,"RectFillColor")&&this.RectFillColor.setColor(t.RectFillColor),D(t,"RectDisplayEffect")&&this.RectDisplayEffect.setRectDisplayEffect(t.RectDisplayEffect))},isDefault:function(){return 0===this.RectBorderType&&0===this.RectZOrder&&this.Rect.isDefault()&&this.RectBorderColor.isDefault()&&this.RectFillColor.isDefault()&&this.RectDisplayEffect.isDefault()}};var B=function(t,e,i,s,r){this.Italic=t||!1,this.Underline=e||!1,this.EdgeType=i||0,this.TextTag=s||0,this.Offset=r||0,this.EdgeColor=new E};B.prototype={reset:function(){this.Italic=!1,this.Underline=!1,this.EdgeType=0,this.TextTag=0,this.Offset=0,this.EdgeColor.reset()},isDefault:function(){return this.EdgeColor.isDefault()&&!this.Underline&&!this.Italic&&0===this.EdgeType&&0===this.TextTag&&0===this.Offset},setFontEffectInfo:function(t){if(!t)return!1;return y(["Italic","Underline","EdgeType","TxtTag","Offset"],t,this),D(t,"EdgeColor")&&this.EdgeColor.setColor(t.EdgeColor),!0},equals:function(t){return this.Italic===t.Italic&&this.Underline===t.Underline&&this.EdgeType===t.EdgeType&&this.TextTag===t.TextTag&&this.Offset===t.Offset&&this.EdgeColor.equals(t)}};var A=function(t,e){this.FontSize=t||"small",this.FontStyle=e||0,this.FontColor=new E};A.prototype={reset:function(){this.FontSize="small",this.FontStyle=0,this.FontColor.reset()},isDefault:function(){return this.FontColor.isDefault()&&"small"===this.FontSize&&0===this.FontStyle},setFontInfo:function(t){return!!t&&(D(t,"FontSize")&&(this.FontSize=t.FontSize),D(t,"FontStyle")&&(this.FontStyle=t.FontStyle),D(t,"FontColor")&&this.FontColor.setColor(t.FontColor),!0)},equals:function(t){return this.FontSize===t.FontSize&&this.FontStyle===t.FontStyle&&this.FontColor.equals(t.FontColor)}};var x=function(t,e){this.FontInfo=new A(t),this.FontEffectInfo=new B(e)};x.prototype={reset:function(){this.FontInfo.reset(),this.FontEffectInfo.reset()},isDefault:function(){return this.FontInfo.isDefault()&&this.FontEffectInfo.isDefault()},setCharInfo:function(t){t&&(D(t,"FontInfo")&&this.FontInfo.setFontInfo(t.FontInfo),D(t,"FontEffectInfo")&&this.FontEffectInfo.setFontEffectInfo(t.FontEffectInfo))},equals:function(t){return this.FontInfo.equals(t.FontInfo)&&this.FontEffectInfo.equals(t.FontEffectInfo)}};var P=function(t,e){this.uchar=t||" ",this.CharInfo=new x(e)};P.prototype={reset:function(){this.uchar=" ",this.CharInfo.reset()},setChar:function(t,e){this.uchar=t,this.CharInfo.setCharInfo(e)},setCharInfo:function(t){this.CharInfo.setCharInfo(t)},getCharInfo:function(){return this.CharInfo},equals:function(t){return this.uchar===t.uchar&&this.CharInfo.equals(t.CharInfo)},isEmpty:function(){return" "===this.uchar&&this.CharInfo.isDefault()}};var _=function(t,e,i){this.dataBox=new F,this.hj=t||0,this.vj=e||0,this.pd=i||0};_.prototype={reset:function(){this.dataBox.reset(),this.hj=0,this.vj=0,this.pd=0},setTextDes:function(t){if(!t)return!1;D(t,"dataBox")&&this.dataBox.setRectInfo(t.dataBox);return y(["hj","vj","pd"],t,this),!0},isDefault:function(){return this.dataBox.isDefault()&&0===this.hj&&0===this.vj&&0===this.pd}};var W=function(){this.fo=0,this.fr=0,this.fg=0,this.fb=0,this.bo=0,this.br=0,this.bg=0,this.bb=0,this.er=0,this.eg=0,this.eb=0};W.prototype={load:function(t,e){return 3>e?(v.log("ERROR","708ClosedCaption Error:PenColor less para"),0):(this.fo=u(t[0]),this.fr=c(t[0]),this.fg=l(t[0]),this.fb=f(t[0]),this.bo=u(t[1]),this.br=c(t[1]),this.bg=l(t[1]),this.bb=f(t[1]),this.er=c(t[2]),this.eg=l(t[2]),this.eb=f(t[2]),3)}};var U=function(){this.tt=0,this.o=0,this.s=0,this.i=0,this.u=0,this.et=0,this.fs=0};U.prototype={load:function(t,e){return 2>e?(console.log("ERROR","708 ClosedCaption Error:PenAttri less para"),0):(this.tt=C(t[0]),this.o=l(t[0]),this.s=f(t[0]),this.i=o(t[1]),this.u=a(t[1]),this.et=d(t[1]),this.fs=p(t[1]),2)}};var k=function(){this.fo=0,this.fr=0,this.fg=0,this.fb=0,this.bt0=0,this.br=0,this.bg=0,this.bb=0,this.bt2=0,this.ww=0,this.pd=0,this.sd=0,this.j=0,this.es=0,this.ed=0,this.de=0};k.prototype={load:function(t,e){return 4>e?(v.log("ERROR","708 ClosedCaption Error:WindAttri less para"),0):(this.fo=u(t[0]),this.fr=c(t[0]),this.fg=l(t[0]),this.fb=f(t[0]),this.bt0=u(t[1]),this.br=c(t[1]),this.bg=l(t[1]),this.bb=f(t[1]),this.bt2=o(t[2]),this.ww=a(t[2]),this.pd=c(t[2]),this.sd=l(t[2]),this.j=f(t[2]),this.es=C(t[3]),this.ed=l(t[3]),this.de=f(t[3]),4)}};var M=function(t){this.columnCnt=t||32,this.pos=0,this.text=[];for(var e=0;e<this.columnCnt;e++)this.text.push(new P);this.textDes=new _};M.prototype={reset:function(){this.pos=0;for(var t=0;t<this.columnCnt;t++)this.text[t].reset();this.textDes.reset()},isEmpty:function(){for(var t=!0,e=0;e<this.columnCnt;e++)if(!this.text[e].isEmpty()){t=!1;break}return t},setTextDes:function(t){this.textDes.setTextDes(t)},getTextDes:function(){return this.textDes},insertTextInfo:function(t,e){if(this.pos+t.length>this.columnCnt)return!1;var i=String.fromCharCode(t);return this.pos>=this.columnCnt?(v.log("DEBUG","Cannot insert "+t.toString(16)+" ("+i+") at position "+this.pos+". Skipping it!"),!1):(this.text[this.pos].setChar(i,e),this.moveCursor(1),!0)},moveAbsCursor:function(t){var e=t-this.pos;this.moveCursor(e)},moveCursor:function(t,e){e=void 0!==e&&e;var i=this.pos+t;if(i>this.columnCnt)return 1;if(0===t)return 0;if(t>1)for(var s=this.pos+1;s<i+1;s++)this.text[s].setChar(" ",this.text[this.pos].getCharInfo());this.setCursor(i)},setCursor:function(t){this.pos!==t&&(this.pos=t),this.pos<0?(v.log("ERROR","Negative cursor position "+this.pos),this.pos=0):this.pos>this.columnCnt&&(v.log("ERROR","Too large cursor position "+this.pos),this.pos=this.columnCnt)},getCursor:function(){return this.pos},clearFromPos:function(t){var e;for(e=t;e<this.columnCnt;e++)this.text[e].uchar=" ",this.text[e].CharInfo.reset()},clear:function(){this.clearFromPos(0),this.pos=0},getTextString:function(){var t=[],e=!0;if(0===this.pos)return"";for(var i=0;i<this.columnCnt;i++){var s=" ";this.text[i]&&(s=this.text[i].uchar)," "!==s&&(e=!1),t.push(s)}return e?"":t.join("")},isEqual:function(t,e){return this.textInfos[e].char==t.textInfos[e].char&&this.textInfos[e].stringInfo==t.textInfos[e].stringInfo},equals:function(t){for(var e=!0,i=0;i<this.columnCnt;i++)if(!this.isEqual(t,i)){e=!1;break}return e}};var N=function(t,e){this.wrap=t||0,this.sd=e||0};N.prototype={reset:function(){this.wrap=0,this.sd=0},setTextDescriptor:function(t){y(["wrap","sd"],t,this)}};var L=function(t,e,i){this.WindID=-1,this.visible=!1,this.rl=0,this.cl=0,this.priority=0,this.rp=0,this.av=0,this.ah=0,this.ap=0,this.rc=0,this.cc=0,this.ws=0,this.ps=0,this.penColor=new W,this.penAttri=new U,this.windAttri=new k,this.update=!1,this.bAdjustRowFlag=!1,this.currRow=-1,this.rowCnt=e||15,this.columnCnt=i||32,this.rectInfo=new F,this.textDisplayInfo=new N,this.curCharInfo=new x,this.rowTextInfos=[];for(var s=0;s<this.rowCnt;s++)this.rowTextInfos.push(new M(this.columnCnt))};L.prototype={reset:function(){this.WindID=-1,this.visible=!1,this.update=!1,this.bAdjustRowFlag=!1,this.currRow=-1,this.textDisplayInfo.reset(),this.resetTextInfo()},resetTextInfo:function(t){t=void 0!==t&&t;for(var e=0;e<this.rowTextInfos.length;e++)this.rowTextInfos[e].reset();this.curCharInfo.reset(),t||(this.rectInfo.reset(),this.rectInfo.RectBorderColor.Trans=0,this.rectInfo.RectFillColor.Trans=0)},setCurrRow:function(t){return!!this.isRowValid(t)&&(v.log("DEBUG","[Cea708Window] [setCurrRow] "+t),this.currRow=t,!0)},getCurrRow:function(){return v.log("DEBUG","[Cea708Window] [getCurrRow] "+this.currRow),this.currRow},isRowValid:function(t){return!(0>t||this.rowCnt<=t)},setRectInfo:function(t){t&&this.rectInfo.setRectInfo(t)},getRectInfo:function(){return this.rectInfo},setRowDes:function(t){for(var e=0;e<this.rowCnt;e++)this.rowTextInfos[e].setTextDes(t)},setTextDisplayInfo:function(t){t&&this.textDisplayInfo.setTextDescriptor(t)},setCharInfo:function(t){t&&this.curCharInfo.setCharInfo(t)},insertChars:function(t){if(!this.isRowValid(this.currRow))return!1;var e=this.rowTextInfos[this.currRow];v.log("DEBUG","[window:insertChar] row:"+this.currRow);for(var i=0;i<t.length;i++)e.insertTextInfo(t[i],this.curCharInfo);return this.UpdateWindInfo(),v.log("DEBUG","[cea708window: insertChars] chars:"+this.getDisplayText(!0)),!0},UpdateWindInfo:function(t){t=void 0!==t&&t,(this.visible||t)&&(this.update=!0)},cc_BS:function(){(v.log("708 Info: BS"),this.isRowValid(this.currRow))&&(this.rowTextInfos[this.currRow].pos>0&&this.rowTextInfos[this.currRow].moveCursor(-1))},cc_CR:function(){if(v.log("708 CR - Carriage Return"),this.isRowValid(this.currRow)){var t=I(this.rectInfo.Rect.Top);I(this.rectInfo.Rect.Bottom)-1>=this.getCurrRow()+1?this.parseCRNonRollup():this.parseCRRollup(t)}},cc_HCR:function(){v.log("708 HCR"),this.isRowValid(this.currRow)&&this.rowTextInfos[this.currRow].moveAbsCursor(0)},parseCRNonRollup:function(){switch(this.windAttri.pd){case e.LEFT_TO_RIGHT:e.BOTTOM_TO_TOP==this.windAttri.sd?this.setCurrRow(this.getCurrRow()+1):e.TOP_TO_BOTTOM==this.windAttri.sd&&this.setCurrRow(this.getCurrRow()-1),this.rowTextInfos[this.currRow].moveAbsCursor(0);break;case e.RIGHT_TO_LEFT:e.BOTTOM_TO_TOP==this.windAttri.sd?this.setCurrRow(this.getCurrRow()+1):e.TOP_TO_BOTTOM==this.windAttri.sd&&this.setCurrRow(this.getCurrRow()-1),this.rowTextInfos[this.getCurrRow()].moveAbsCursor(m(this.rectInfo.Rect.Right-1));break;case e.TOP_TO_BOTTOM:e.LEFT_TO_RIGHT==this.windAttri.sd?this.rowTextInfos[this.currRow].moveCursor(-1):e.RIGHT_TO_LEFT==this.windAttri.sd&&this.rowTextInfos[this.currRow].moveCursor(1),this.setCurrRow(this.rectInfo.Rect.Top);break;case e.BOTTOM_TO_TOP:e.LEFT_TO_RIGHT==this.windAttri.sd?this.rowTextInfos[this.currRow].moveCursor(-1):e.RIGHT_TO_LEFT==this.windAttri.sd&&this.rowTextInfos[this.currRow].moveCursor(1),this.setCurrRow(this.rectInfo.Rect.Bottom-1)}},parseCRRollup:function(t){if(this.isRowValid(this.currRow))if(this.bAdjustRowFlag)this.adjustRowWhenNoSPLCmd(this.getCurrRow());else{var e=this.rowTextInfos.splice(t,1)[0];e.clear(),this.rowTextInfos.splice(this.currRow,0,e)}},adjustRowWhenNoSPLCmd:function(t){if(t>=I(this.rectInfo.Rect.Bottom)-1||3<=t){this.setCurrRow(0);for(var e=0;e<=t;e++)this.rowTextInfos[e]&&this.rowTextInfos[e].moveAbsCursor(0)}else this.setCurrRow(t+1),this.rowTextInfos[this.currRow]&&this.rowTextInfos[this.currRow].moveAbsCursor(0)},copyChar:function(t,e){t>=this.rowCnt||e>=this.rowCnt||!this.rowTextInfos[t].pos||(this.rowTextInfos[e].textInfos=this.rowTextInfos[t].textInfos,this.rowTextInfos[e].pos=this.rowTextInfos[t].pos,this.rowTextInfos[t].pos=0)},setAdjustRowFlag:function(t){this.bAdjustRowFlag=t},getDisplayText:function(t){t=t||!1;for(var e=[],i="",s=-1,r=0;r<this.rowCnt;r++){var n=this.rowTextInfos[r].getTextString();n&&(s=r,t?e.push("Row "+s+': "'+n+'"'):e.push(n.trim()))}return e.length>0&&(i=t?"["+e.join("|")+"]":e.join("\n")),i},SetWindowRectInfo:function(t,e,i,s,r,n){var o=0,a=0,h=0,u=0;e?(o=parseInt(15*i/100),h=parseInt(32*s/100)):(o=parseInt(i/5),h=parseInt(s/5)),o&&(o-=1),h&&(h-=1),1===parseInt(t/3)?o>=parseInt(r/2)&&(o-=parseInt(r/2)):2===parseInt(t/3)&&o>=r-1&&(o-=r-1),1==parseInt(t%3)?h>=parseInt(n/2)&&(h-=parseInt(n/2)):2===parseInt(t%3)&&h>=n-1&&(h-=n-1),a=o+(r-1),u=h+(n-1),o=o>14?14:o,a=a>14?14:a,h=h>31?31:h,u=u>31?31:u;var c=new O;if(c){S(c,o,a,h,u);var l={Rect:c};this.setRectInfo(l)}},MapColor2RGB:function(t,e,i){if(t>3||e>3||i>3)return null;var s=new E;return s.Red=85*t,s.Green=85*e,s.Blue=85*i,s},SetWindowAttri:function(t,e,i){var s=t.load(e,i),r={hj:parseInt(t.j%3),pd:t.pd};this.setRowDes(r);var n=this.MapColor2RGB(this.windAttri.br,this.windAttri.bg,this.windAttri.bb);n.Trans=0;var o=this.MapColor2RGB(this.windAttri.fr,this.windAttri.fg,this.windAttri.fb);switch(o.Trans=0,this.windAttri.fo){case 0:case 1:o.Trans=255;break;case 2:o.Trans=191;break;case 3:o.Trans=0}var a={RectBorderType:this.windAttri.bt2<<3|this.windAttri.bt0,RectBorderColor:n,RectFillColor:o,RectDisplayEffect:{EffectType:this.windAttri.de,EffectSpeed:this.windAttri.es,EffectDirection:this.windAttri.ed}};return this.setRectInfo(a),this.setTextDisplayInfo({wrap:this.windAttri.ww,sd:this.windAttri.sd}),this.UpdateWindInfo(),s},SetPenAtti:function(t,e,i){var s=t.load(e,i),r={Italic:this.penAttri.i,Underline:this.penAttri.u,EdgeType:this.penAttri.et,TextTag:this.penAttri.tt,offSet:this.penAttri.o},n="small";switch(this.penAttri.s){case 0:n="small";break;case 1:n="medium";break;case 2:n="large"}var o={FontInfo:{FontSize:n,FontStyle:this.penAttri.fs},FontEffectInfo:r};return this.setCharInfo(o),this.UpdateWindInfo(),v.log("DEBUG","[wind: SetPenAtti]"),s},SetPenColor:function(t,e,i){var s=t.load(e,i),r=this.MapColor2RGB(this.penColor.fr,this.penColor.fg,this.penColor.fb);0===this.penColor.fo||1===this.penColor.fo?r.Trans=255:2===this.penColor.fo?r.Trans=191:r.Trans=0;var n=this.MapColor2RGB(this.penColor.er,this.penColor.eg,this.penColor.eb);n.Trans=r.Trans;var o={FontInfo:{FontColor:r},FontEffectInfo:{EdgeColor:n}};this.setCharInfo(o);var a=this.MapColor2RGB(this.penColor.br,this.penColor.bg,this.penColor.bb);return 0===this.penColor.bo||1===this.penColor.bo?a.Trans=255:2===this.penColor.bo?a.Trans=191:a.Trans=0,(new _).dataBox.RectFillColor=a,this.setRowDes({dataBox:{RectFillColor:a}}),this.UpdateWindInfo(),v.log("DEBUG","[wind: SetPenColor]"),s},load:function(t,e){if(7>e)return v.log("ERROR","ClosedCaption Error:DFCommandPara less para"),e;this.WindID=p(t[0]),this.setVisible(h(t[1])),v.log("DEBUG","[wind: load] windID:"+this.WindID,", visible:"+h(t[1])),this.rl=t[1]>>4&1,this.cl=function(t){return t>>3&1}(t[1]),this.priority=p(t[1]),this.rp=o(t[2]),this.av=function(t){return 127&t}(t[2]),this.ah=t[3],this.ap=C(t[4]),this.rc=w(t[4]),this.rc+=1,this.cc=R(t[5]),this.cc+=1,this.SetWindowRectInfo(this.ap,this.rp,this.av,this.ah,this.rc,this.cc),this.ws=d(t[6]),this.ws||(this.ws=1),this.ps=p(t[6]),this.ps||(this.ps=1),this.ws&&this.SetWindowAttri(this.windAttri,s[this.ws-1],4),this.ps&&(this.SetPenAtti(this.penAttri,r[this.ps-1],2),this.SetPenColor(this.penColor,n[this.ps-1],3));var i=this.getRectInfo(),a=I(i.Rect.Top,!0),u=I(i.Rect.Bottom,!0)-1,c=this.getCurrRow();if(this.isRowValid(c)&&(c<a||c>u)){for(var l=0;l<a;)this.rowTextInfos[c].clear(),l++;for(l=u+1;l<this.rowCnt;)this.rowTextInfos[c].clear(),l++;this.setCurrRow(a),3===this.windAttri.sd&&this.setCurrRow(u)}return 7},setVisible:function(t){v.log("DEBUG","[setVisible]this.visible:"+this.visible+", bVisible:"+t),0===t?t=!1:1===t&&(t=!0),t!==this.visible&&(this.UpdateWindInfo(!0),this.visible=t)},isEmpty:function(){for(var t=!0,e=0;e<this.rowCnt;e++)if(this.rowTextInfos[e]&&!this.rowTextInfos[e].isEmpty()){t=!1;break}return t},equals:function(t){for(var e=!0,i=0;i<this.rowCnt;i++)if(!this.rowTextInfos[i].equals(t.rowTextInfos[i])){e=!1;break}return e},getSubtitleData:function(){var t=[],e=[],i=I(this.getRectInfo().Rect.Top),s=I(this.getRectInfo().Rect.Bottom)-1;for(i=i<=(s=s<=this.rowCnt-1?s:this.rowCnt-1)?i:0;i<=s;)this.rowTextInfos[i].pos?(e.push(this.rowTextInfos[i]),i++):i++;return t.push({rectInfo:this.rectInfo,TextRowInfo:e,TextDisplayInfo:this.TextDisplayInfo}),t}};var G=function(){this.captionArray=[],this.is708cc=!0,this.type=" "};G.prototype={reset:function(){this.captionArray=[],this.type=" "},findWindByID:function(t){for(var e=0;e<this.captionArray.length;e++)if(t===this.captionArray[e].WindID)return this.captionArray[e];return null},delCaptionByID:function(t){for(var e=0;e<this.captionArray.length;e++)t===this.captionArray[e].WindID&&this.captionArray.splice(e,1)},getDisplayText:function(t){t=t||!1;var e=[],i="",s=-1;if(!this.captionArray)return i;for(var r=0;r<this.captionArray.length;r++)if(this.captionArray[r]){var n=this.captionArray[r].getDisplayText(t);n&&(s=this.captionArray[r].WindID,t?e.push("Window "+s+': "'+n+'"'):e.push(n.trim()))}return e.length>0&&(i=t?"["+e.join("|")+"]":e.join("\n")),i},isEmpty:function(){var t=!0;if(this.captionArray)for(var e=0;e<this.captionArray.length;e++)if(this.captionArray[e]&&!this.captionArray[e].isEmpty()){t=!1;break}return t}};var j=function(t,e){this.type=t,this.windows=[],this.outputFilter=e,this.CurrWindID=-1,this.bClearScreen=!1,this.cueStartTime=null,this.captionScreen=new G,this.startTime=null,this.lastTime=null,this.mode=null};j.prototype={reset:function(){this.CurrWindID=-1,this.bClearScreen=!1,this.cueStartTime=null,this.mode=null,this.captionScreen&&this.captionScreen.reset(),this.windows.length>0&&this.windows.forEach((function(t){return t.reset()}))},getHandler:function(){return this.outputFilter},setHandler:function(t){this.outputFilter=t},setCaptionScreen:function(t){this.setOutputScreen(),this.captionScreen.type=this.type,this.setDisplayTime(t)},isCaptionScreenEmpty:function(){return!this.captionScreen||this.captionScreen.isEmpty()},setDisplayTime:function(t){for(var e=0;e<this.captionScreen.captionArray.length;e++){var i=this.captionScreen.captionArray[e];-1!==i.WindID&&t===i.WindID&&(i.cueStartTime?v.time!==i.cueStartTime&&(i.cueEndTime=v.time):i.cueStartTime=v.time)}},displayDataUpdate:function(t,e){for(var i=0;i<this.captionScreen.captionArray.length;i++){var s=this.captionScreen.captionArray[i];if(-1!==s.WindID&&e===s.WindID&&s.cueStartTime&&s.cueEndTime&&s.cueStartTime!==s.cueEndTime&&s.cueStartTime<s.cueEndTime&&s.cueStartTime!==t){var r=new G;r.captionArray.push(s),r.type=this.captionScreen.type,this.outputFilter.newCue&&(this.outputFilter.newCue(s.cueStartTime,s.cueEndTime,r),this.captionScreen.captionArray.splice(i,1),delete s.cueStartTime,delete s.cueEndTime)}}},outputDataUpdate:function(t){var e=v.time;null!==e?this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.captionScreen),this.setDisplayTime(t),this.displayDataUpdate(e,t)):v.log("ERROR","[outputDataUpdate]t is null., logger time:"+v.time)},cueSplitAtTime:function(t){v.log("DEBUG","cueSplitAtTime: "+t),this.outputFilter&&(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.captionScreen),this.cueStartTime=t)},setOutputScreen:function(){var t=!1,e=0;for(e=0;e<this.windows.length;e++)if(v.log("DEBUG","[setOutputScreen]windID:"+this.windows[e].WindID+", update:"+this.windows[e].update+", visible:"+this.windows[e].visible),-1!==this.windows[e].WindID&&this.windows[e].update){t=!0;break}t&&this.getWindowsInfo()},getWindInfo:function(){for(var t=[],e=0;e<this.windows.length;e++)if(this.windows[e]&&-1!==this.windows[e].WindID&&this.windows[e].visible&&!this.windows[e].isEmpty()){var i=this.windows[e].getSubtitleData();i.length&&(t.push(i),v.log("DEBUG","[getWindInfo]wind:"+this.windows[e].WindID+", Text:"+this.windows[e].getDisplayText(!0)))}return t},getWindowsInfo:function(){for(var t=0;t<this.windows.length;t++)this.windows[t]&&-1!==this.windows[t].WindID&&this.windows[t].visible&&(this.windows[t].isEmpty()||this.captionScreen.findWindByID(this.windows[t].WindID)||" "!=this.windows[t].getDisplayText(!0)&&(this.captionScreen.captionArray.push(this.windows[t]),v.log("DEBUG","[getWindowsInfo]wind:"+this.windows[t].WindID+", Text:"+this.windows[t].getDisplayText(!0))))},isEmpty:function(){for(var t=!0,e=0;e<this.windows.length;e++)if(!this.windows[e].isEmpty()){t=!1;break}return t},FindWindByID:function(t){if(0>t||7<t)return null;var e=0;for(e=0;e<this.windows.length;e++)if(t===this.windows[e].WindID)return this.windows[e];return e===this.windows.length?null:void 0},findWindIndexByID:function(t){if(0>t||7<t)return-1;var e=0;for(e=0;e<this.windows.length;e++)if(t===this.windows[e].WindID)return e;return e===this.windows.length?-1:void 0},delWindByID:function(t){var e=this.findWindIndexByID(t);0>e||7<e||this.windows.splice(e,1)},addData:function(t,e){this.lastTime=t,v.setTime(t);var i=0,s=0,r=null;for(this.CurrWindID>=0&&(r=this.FindWindByID(this.CurrWindID));i<e.length;){var n=!1;if(16===e[i]&&(n=!0,i+=1),32<=e[i]&&127>=e[i]||160<=e[i])r&&r.update&&r.visible&&this.outputDataUpdate(this.CurrWindID),this.parseStandardChar(e[i],1,n),s+=1,i+=1;else{var o=e.slice(i);i+=this.parseNonStandardChar(o,e.length-i,n)}}0<s&&r&&r.update&&r.visible&&this.setCaptionScreen(this.CurrWindID)},parseNonStandardChar:function(t,e,i){v.log("INFO","[parseNonStandardChar] byte:"+t[0].toString(16)+"("+t[0]+"), size:"+e+", ExtCode:"+i);var s=0;if(0<=t[0]&&31>=t[0]){if(i)return t[0]/8+1;s=this.parseC0Code(t,e)}else if(128<=t[0]&&159>=t[0]){if(i)return 143>=t[0]?(t[0]-128)/8+5:2>e?(v.log("ERROR","ClosedCaption Error:ParserC1 EXT Code size <2:%d",e),e):2+(31&t[1]);s=this.parseC1Code(t,e)}return s},parseC0Code:function(t,e){var i=1;if(16<=t[0]&&24>t[0])i=2;else if(24<=t[0]&&31>=t[0])i=3;else if(e<i)return v.log("ERROR","ClosedCaption Error:ParserC0Code cbInputData < ret:%d:%d",e,i),e;if(0<=this.CurrWindID&&7>=this.CurrWindID){var s=this.FindWindByID(this.CurrWindID);if(!s)return i;switch(s.UpdateWindInfo(!1),t[0]){case 3:break;case 8:s.cc_BS();break;case 12:s.resetTextInfo(!0);var r=s.getRectInfo(),n=I(r.Rect.Top,!0);s.setCurrRow(n);break;case 13:this.outputDataUpdate(this.CurrWindID),s.cc_CR(this.mode);break;case 14:s.cc_HCR(),this.outputDataUpdate(this.CurrWindID);break;case 16:v.log("DEBUG","ClosedCaption Error:EXT1 should not exist here");break;case 24:v.log("DEBUG","ClosedCaption Error:not supported P16")}}return i},parseC1Code:function(t,e){var i=0;if(152<=t[0]&&159>=t[0]){this.CurrWindID=t[0]-152;var s=this.FindWindByID(this.CurrWindID);s?this.mode="MODE_ROLL-UP":(s=new L(this.CurrWindID),this.windows.push(s)),i=s.load(t,e),s.visible?"MODE_ROLL-UP"!==this.mode&&(this.mode="MODE_PAINT-ON"):this.mode="MODE_PAINT-ON"}else if(128<=t[0]&&135>=t[0])this.CurrWindID=t[0]-128,i=1;else switch(t[0]){case 136:i=this.parseCLWCode(t,e);break;case 137:i=this.parseDSWCode(t,e);break;case 138:i=this.parseHDWCode(t,e);break;case 139:i=this.parseTGWCode(t,e);break;case 140:i=this.parseDLWCode(t,e);break;case 141:i=2;break;case 142:i=1;break;case 143:v.log("DEBUG","[CC_RET] CurrWindID:"+this.CurrWindID);var r=this.FindWindByID(this.CurrWindID);r&&(this.outputDataUpdate(this.CurrWindID),this.CurrWindID=-1,r.reset()),i=1;break;case 144:i=this.parseSPACode(t,e);break;case 145:i=this.parseSPCCode(t,e);break;case 146:i=this.parseSPLCode(t,e);break;case 151:i=this.parseSWACode(t,e);break;default:i=1}return i},parseCLWCode:function(t,e){var i=0,s=1;if(2>e)return v.log("ERROR","ClosedCaption Error:CLW less para"),e;for(;8>i;){if(t[1]&s){var r=this.FindWindByID(i);if(!r)return 2;r.resetTextInfo(!0),r.UpdateWindInfo();var n=r.getRectInfo(),o=I(n.Rect.Top,!0);r.setCurrRow(o)}s*=2,i++}return 2},parseDSWCode:function(t,e){if(2>e)return v.log("ERROR","ClosedCaption Error:DSW less para"),e;for(var i=0,s=1;8>i;){if(t[1]&s){var r=this.FindWindByID(i);r&&(r.setVisible(!0),this.setCaptionScreen(i))}s*=2,i++}return 2},parseHDWCode:function(t,e){if(2>e)return v.log("ERROR","ClosedCaption Error:HDW less para"),e;for(var i=0,s=1;8>i;){if(t[1]&s){var r=this.FindWindByID(i);r&&(this.outputDataUpdate(i),r.setVisible(!1))}s*=2,i++}return 2},parseTGWCode:function(t,e){if(2>e)return v.log("ERROR","ClosedCaption Error:TGW less para"),e;for(var i=0,s=1;8>i;){if(t[1]&s){var r=this.FindWindByID(i);r&&(r.setVisible((r.visible+1)%2),r.visible&&this.setCaptionScreen(i))}s*=2,i++}return 2},parseDLWCode:function(t,e){if(2>e)return v.log("ERROR","ClosedCaption Error:DLW less para"),e;for(var i=0,s=1;8>i;){if(t[1]&s)this.FindWindByID(i)&&(this.outputDataUpdate(i),this.delWindByID(i)),i===this.CurrWindID&&(this.CurrWindID=-1,this.bClearScreen=!0);s*=2,i++}return 2},parseSPACode:function(t,e){if(3>e)return v.log("ERROR","ClosedCaption Error:SPA less para"),e;var i=this.FindWindByID(this.CurrWindID);if(i){var s=t.slice(1);i.SetPenAtti(i.penAttri,s,e-1)}return 3},parseSPCCode:function(t,e){if(4>e)return v.log("ERROR","ClosedCaption Error:SPC less para"),e;var i=this.FindWindByID(this.CurrWindID);if(i){var s=t.slice(1);i.SetPenColor(i.penColor,s,e-1)}return 4},parseSPLCode:function(t,e){if(2>e)return v.log("ERROR","ClosedCaption Error:SPL less para"),e;var i=this.FindWindByID(this.CurrWindID);if(!i)return e>2?3:2;i.setAdjustRowFlag(!1);var s=I(i.getRectInfo().Rect.Top),r=w(t[1]);i.setCurrRow(s+r);var n=0;2<e&&(n=R(t[2]));var o=i.getCurrRow();return i.isRowValid(o)&&(i.rowTextInfos[o].pos>0?"MODE_ROLL-UP"!==this.mode&&i.rowTextInfos[o].moveAbsCursor(n):i.rowTextInfos[o].setCursor(n)),i.UpdateWindInfo(!1),e>2?3:2},parseSWACode:function(t,e){if(5>e)return v.log("ERROR","ClosedCaption Error:SWA less para"),e;var i=this.FindWindByID(this.CurrWindID);if(i){var s=t.slice(1);i.SetWindowAttri(i.windAttri,s,e-1)}return 5},parseStandardChar:function(t,e,s){v.log("INFO","[parseStandardChar] byte:"+t.toString(16)+"("+t+"), size:"+e+", ExtCode:"+s+", curWindID:"+this.CurrWindID);var r,n=t;if(s){for(var o=0;o<27;o++)if(n==i[o][0]){n=i[o][1];break}27==o&&(n=95)}else 127==n&&(n=9834);if(r=[n]){var a=function(t){for(var e=[],i=0;i<t.length;i++)e.push(t[i].toString(16));return e}(r);if(v.log("DEBUG","708 Char codes =  "+a.join(",")),this.CurrWindID>=0){var h=this.FindWindByID(this.CurrWindID);if(h){if(-1===h.getCurrRow()){var u=h.getRectInfo();if(u){var c=I(u.Rect.Top);h.setCurrRow(c),h.setAdjustRowFlag(!0)}}h.insertChars(r)}}else v.log("WARNING","No window found yet.");return!0}return!1}};var z=function(){this.serData=[],this.serDataSize=0};z.prototype={reset:function(){this.serDataSize=0,this.serData=[]},saveSerDate:function(t){this.serData=this.serData.concat(t)}};var q=function(){this.allserDataSize=0,this.serData=[];for(var t=1;t<=6;t++)this.serData[t]=new z};q.prototype={reset:function(){for(var t=1;t<this.serData.length;t++)this.serData[t].reset();this.allserDataSize=0},extractCea708DataFromService:function(t,e){this.reset();for(var i=e,s=0;i>0;){var r=t[s]>>5,n=g(t[s]);if(i--,s++,0===r)return 0!==n&&v.log("DEBUG","[extractCea708DataFromService] Error:serviceNo is 0,but blockSize is not 0"),this.allserDataSize;7==r&&0<n&&(r=R(t[s]),i--,s++),n>e-s&&(n=e-s,v.log("DEBUG","[extractCea708DataFromService] ServiceBlock Packet size bigger than nBlockSize")),this.allserDataSize+n>63&&(v.log("DEBUG","[extractCea708DataFromService] ServiceBlock Packet Out of Memory"),n=63-this.allserDataSize);var o=t.slice(s,n+s);this.serData[r]&&(this.serData[r].saveSerDate(o),this.serData[r].serDataSize+=n,this.allserDataSize+=n),s+=n,i-=n}return this.allserDataSize}};var H=function(){this.seqNo=-1,this.packetSize=0,this.serviceBlock=new q,this.lastSeqNo=-1,this.serNoSetting=1};H.prototype={reset:function(){this.seqNo=-1,this.packetSize=0,this.serviceBlok.reset(),this.lastSeqNo=-1,this.serNoSetting=1},extractCea708DataFromPacket:function(t){this.seqNo=u(t[0]),-1!=this.lastSeqNo&&this.seqNo!=(this.lastSeqNo+1)%4&&v.log("DEBUG","[extractCea708DataFromPacket] Error:DTVCCCaption Packet lost. lastSeqNo: "+this.lastSeqNo+" SeqNo: "+this.seqNo),this.lastSeqNo=this.seqNo,this.packetSize=R(t[0]),this.packetSize?this.packetSize=2*this.packetSize-1:this.packetSize=128,this.packetSize>t.length-1&&(this.packetSize=t.length-1,v.log("DEBUG","[extractCea708DataFromPacket] Error:DTVCCCaption Packet size bigger than nPacketSize"));var e=t.slice(1);return this.serviceBlock.extractCea708DataFromService(e,this.packetSize)}},t.logger=v,t.Cea708parser=j,t.Cea708PacketParser=H,t.setRectPos=S,t.RectPos=O}(e)}]);